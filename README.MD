<h1 align="center">

## ğŸ¨ Suvinil IA - Sistema Inteligente de RecomendaÃ§Ã£o de Tintas

SoluÃ§Ã£o inovadora para o desafio Suvinil: sistema de recomendaÃ§Ã£o inteligente de tintas baseado em anÃ¡lise de ambiente usando IA. Backend FastAPI com agentes CrewAI que analisam descriÃ§Ãµes de ambiente (cheiro, lavabilidade, superfÃ­cie, clima, preferÃªncias de cor) e recomendam produtos Suvinil ideais via RAG. Arquitetura robusta com RBAC, JWT, auditoria e observabilidade.
</h1>

<p align="center">
   ğŸ† Desenvolvido para o Desafio Loomi 20205 - Transformando a experiÃªncia de escolha de tintas atravÃ©s de InteligÃªncia Artificial
</p>

<p align="center">
  <a href="#ğŸ“-sobre-o-projeto">Sobre o Projeto</a> â€¢
  <a href="#ğŸš€-tecnologias">Tecnologias</a> â€¢
  <a href="#ğŸ“‹-requisitos">Requisitos</a> â€¢
  <a href="#ğŸ”§-arquitetura">Arquitetura</a> â€¢
  <a href="#âš™ï¸-como-usar">Como Usar</a> â€¢
  <a href="#ğŸ¤-como-contribuir">Como Contribuir</a> â€¢
  <a href="#ğŸ“„-licenÃ§a">LicenÃ§a</a>
</p>

---

## ğŸ† Desafio Suvinil

**Problema**: Como ajudar consumidores a escolher a tinta ideal para suas necessidades especÃ­ficas?

**SoluÃ§Ã£o**: Sistema IA que analisa descriÃ§Ãµes detalhadas do ambiente e necessidades do usuÃ¡rio:
- ğŸ“ **Input**: UsuÃ¡rio descreve ambiente (cheiro, lavabilidade, superfÃ­cie, clima, preferÃªncias de cor)
- ğŸ¤– **Processamento**: Agentes CrewAI especializados processam a descriÃ§Ã£o usando RAG com base de conhecimento Suvinil
- ğŸ¯ **Output**: RecomendaÃ§Ãµes justificadas de produtos Suvinil com explicaÃ§Ã£o tÃ©cnica

**Arquitetura**: Sistema robusto com autenticaÃ§Ã£o, autorizaÃ§Ã£o, auditoria completa e containerizaÃ§Ã£o.

### ğŸ¯ Funcionalidades Principais

#### ğŸ¤– Sistema de RecomendaÃ§Ã£o Inteligente
- **AnÃ¡lise de Ambiente**: Processamento de descriÃ§Ãµes detalhadas de ambientes usando NLP
- **RecomendaÃ§Ã£o de Produtos**: SugestÃµes personalizadas de tintas Suvinil baseadas em RAG
- **Justificativas TÃ©cnicas**: ExplicaÃ§Ãµes detalhadas sobre por que cada produto foi recomendado
- **Agentes Especializados**: CrewAI com agentes especÃ­ficos para diferentes aspectos (cor, durabilidade, aplicaÃ§Ã£o)

#### ğŸ” Sistema de SeguranÃ§a Robusto  
- **AutenticaÃ§Ã£o JWT**: Login seguro de usuÃ¡rios com tokens de acesso
- **AutorizaÃ§Ã£o RBAC**: Controle granular de acesso baseado em papÃ©is e permissÃµes
- **Auditoria Completa**: Rastreamento de todas as interaÃ§Ãµes (usuÃ¡rio, IP, timestamps)

#### ğŸ‘¥ GestÃ£o de UsuÃ¡rios e PermissÃµes
- **Gerenciamento de UsuÃ¡rios**: CRUD completo para usuÃ¡rios do sistema
- **GestÃ£o de PapÃ©is**: AtribuiÃ§Ã£o flexÃ­vel de papÃ©is e permissÃµes
- **Controle de Acesso**: ValidaÃ§Ã£o de permissÃµes em tempo real

#### ğŸ§ª Qualidade e Observabilidade
- **Testes Automatizados**: Cobertura completa com pytest
- **ContainerizaÃ§Ã£o**: Deploy fÃ¡cil com Docker e Docker Compose
- **Monitoramento**: Logs estruturados e mÃ©tricas de desempenho

O projeto Ã© estruturado para ser modular, escalÃ¡vel e seguir boas prÃ¡ticas de desenvolvimento, como separaÃ§Ã£o de responsabilidades e uso de ferramentas modernas de desenvolvimento Python.

---

## ğŸš€ Tecnologias

### ğŸ¤– Stack de InteligÃªncia Artificial
- **[CrewAI](https://crewai.com/)**: Framework para orquestraÃ§Ã£o de agentes IA especializados
- **[LangChain](https://langchain.com/)**: Framework para desenvolvimento de aplicaÃ§Ãµes com LLMs
- **[Groq](https://groq.com/)**: Plataforma de inferÃªncia de IA com Llama 3.1 8B Instant
- **RAG (Retrieval-Augmented Generation)**: Sistema de recuperaÃ§Ã£o e geraÃ§Ã£o aumentada
- **NLP (Natural Language Processing)**: Processamento de linguagem natural para anÃ¡lise de texto

### ğŸ› ï¸ Stack Backend e Infraestrutura
- **Linguagem**: [Python 3.12](https://www.python.org/) - Linguagem principal do projeto
- **Framework Web**: [FastAPI](https://fastapi.tiangolo.com/) - API moderna e de alta performance
- **ORM**: [SQLAlchemy](https://www.sqlalchemy.org/) - Mapeamento objeto-relacional avanÃ§ado
- **Banco de Dados**: [SQLite](https://sqlite.org/) / [PostgreSQL](https://postgresql.org/) - Flexibilidade entre desenvolvimento e produÃ§Ã£o

### ğŸ”§ Ferramentas de Desenvolvimento
- **Gerenciador de DependÃªncias**: [UV](https://docs.astral.sh/uv/) - Gerenciamento moderno de dependÃªncias Python
- **MigraÃ§Ãµes**: [Alembic](https://alembic.sqlalchemy.org/) - Controle de versÃ£o de banco de dados
- **Testes**: [pytest](https://pytest.org/) + [pytest-cov](https://pytest-cov.readthedocs.io/) - Testes automatizados com cobertura
- **Code Quality**: [Ruff](https://github.com/charliermarsh/ruff) + [isort](https://pycqa.github.io/isort/) - Linting e formataÃ§Ã£o
- **ContainerizaÃ§Ã£o**: [Docker](https://docker.com/) + [Docker Compose](https://docs.docker.com/compose/) - Deploy e orquestraÃ§Ã£o

### ğŸ” SeguranÃ§a e AutenticaÃ§Ã£o  
- **JWT**: [python-jose](https://github.com/mpdavis/python-jose) - Tokens de autenticaÃ§Ã£o seguros
- **Hashing**: [bcrypt](https://pypi.org/project/bcrypt/) - Hash seguro de senhas
- **RBAC**: Sistema prÃ³prio de controle de acesso baseado em papÃ©is

---

## ğŸ“‹ Requisitos

Para rodar ou contribuir com o projeto, vocÃª precisarÃ¡ das seguintes ferramentas instaladas:

| Ferramenta                                         | VersÃ£o       | InstalaÃ§Ã£o (Linux/macOS)                     |
|----------------------------------------------------|--------------|----------------------------------------------|
| [Python](https://www.python.org/)                  | 3.12       | `asdf install python 3.12` ou similar      |
| [UV](https://docs.astral.sh/uv/)                   | Latest       | `curl -LsSf https://astral.sh/uv/install.sh | sh |
| [Git](https://git-scm.com/)                        | Latest       | `sudo apt install git` (Linux) ou `brew install git` (macOS) |
| [SQLite](https://sqlite.org/)                      | Latest       | Geralmente prÃ©-instalado, ou `sudo apt install sqlite3` |

**Nota**: Recomendamos o uso do `asdf` para gerenciar versÃµes do Python. Consulte o arquivo `.python-version` para a versÃ£o exata do Python utilizada.

---

## ğŸ”§ Arquitetura

A estrutura do projeto Ã© organizada para promover modularidade e facilitar a manutenÃ§Ã£o. Abaixo estÃ¡ a organizaÃ§Ã£o dos arquivos e diretÃ³rios:

```bash
FastAPI/
â”œâ”€â”€ apps/                        # AplicaÃ§Ãµes do monÃ³lito
â”‚   â”œâ”€â”€ core/                    # ğŸ” API REST com RBAC
â”‚   â”‚   â”œâ”€â”€ api/                 # Endpoints da API
â”‚   â”‚   â”‚   â”œâ”€â”€ assignment/      # ğŸ‘¥ DesignaÃ§Ãµes (usuÃ¡rio-papel)
â”‚   â”‚   â”‚   â”œâ”€â”€ authentication/  # ğŸ”‘ AutenticaÃ§Ã£o (login, JWT)
â”‚   â”‚   â”‚   â”œâ”€â”€ authorization/   # âœ… AutorizaÃ§Ãµes (papel-transaÃ§Ã£o)
â”‚   â”‚   â”‚   â”œâ”€â”€ role/            # ğŸ·ï¸ Gerenciamento de papÃ©is
â”‚   â”‚   â”‚   â”œâ”€â”€ transaction/     # ğŸ“‹ Gerenciamento de transaÃ§Ãµes
â”‚   â”‚   â”‚   â”œâ”€â”€ user/            # ğŸ‘¤ Gerenciamento de usuÃ¡rios
â”‚   â”‚   â”‚   â””â”€â”€ text_processing/ # ğŸ”„ Processamento de texto (bridge para IA)
â”‚   â”‚   â”œâ”€â”€ database/            # ğŸ—„ï¸ ConfiguraÃ§Ã£o SQLAlchemy
â”‚   â”‚   â”œâ”€â”€ models/              # ğŸ“Š Modelos ORM (User, Role, etc.)
â”‚   â”‚   â”œâ”€â”€ utils/               # ğŸ› ï¸ UtilitÃ¡rios (seguranÃ§a, configs)
â”‚   â”‚   â””â”€â”€ startup.py           # ğŸš€ InicializaÃ§Ã£o FastAPI
â”‚   â”‚
â”‚   â”œâ”€â”€ ia/                      # ğŸ¤– ServiÃ§o de Agentes IA
â”‚   â”‚   â”œâ”€â”€ agents/              # ğŸ§  DefiniÃ§Ã£o dos agentes CrewAI
â”‚   â”‚   â”œâ”€â”€ api/                 # ğŸŒ Endpoints especÃ­ficos da IA
â”‚   â”‚   â”‚   â””â”€â”€ chat/            # ğŸ’­ Chat com agentes
â”‚   â”‚   â”œâ”€â”€ models/              # ğŸ“ˆ Modelos especÃ­ficos da IA
â”‚   â”‚   â”œâ”€â”€ services/            # âš™ï¸ ServiÃ§os da IA
â”‚   â”‚   â”‚   â””â”€â”€ rag_service.py   # ğŸ” RAG com LangChain
â”‚   â”‚   â””â”€â”€ tools/               # ğŸ”§ Ferramentas para agentes
â”‚   â”‚       â””â”€â”€ rag_search_tool.py # ğŸ” Ferramenta de busca RAG
â”‚   â”‚
â”‚   â””â”€â”€ packpage/                # ğŸ“¦ UtilitÃ¡rios compartilhados
â”‚       â”œâ”€â”€ base_model.py        # ğŸ—ï¸ Modelo base com auditoria
â”‚       â”œâ”€â”€ llm.py               # ğŸ§® ConfiguraÃ§Ã£o LLM (Groq)
â”‚       â””â”€â”€ generic_controller.py # ğŸ® Controller genÃ©rico CRUD
â”‚
â”œâ”€â”€ migrations/                  # ğŸ”„ MigraÃ§Ãµes Alembic
â”œâ”€â”€ scripts/                     # ğŸ“œ Scripts de automaÃ§Ã£o
â”œâ”€â”€ seeds/                       # ğŸŒ± Dados iniciais
â”œâ”€â”€ tests/                       # ğŸ§ª Testes automatizados
â”‚   â”œâ”€â”€ factory/                 # ğŸ­ Factories para testes
â”‚   â””â”€â”€ conftest.py              # âš™ï¸ ConfiguraÃ§Ã£o pytest
â”œâ”€â”€ DOCS/                        # ğŸ“š DocumentaÃ§Ã£o
â”‚   â”œâ”€â”€ PERMISSIONS.MD           # ğŸ” Guia RBAC
â”‚   â”œâ”€â”€ FLUXOGRAMA.MD           # ğŸ”„ Fluxos da aplicaÃ§Ã£o
â”‚   â””â”€â”€ DEPLOYMENT.md            # ğŸš€ Deploy em produÃ§Ã£o
â”œâ”€â”€ .devcontainer/               # ğŸ³ ConfiguraÃ§Ã£o dev container
â”œâ”€â”€ .secrets/                    # ğŸ”’ Arquivos sensÃ­veis
â”œâ”€â”€ .env-semple                  # ğŸ“‹ Template de configuraÃ§Ã£o
â”œâ”€â”€ alembic.ini                  # âš™ï¸ ConfiguraÃ§Ã£o Alembic
â”œâ”€â”€ uv.lock                      # ğŸ”’ Lockfile dependÃªncias
â””â”€â”€ pyproject.toml               # ğŸ“¦ ConfiguraÃ§Ã£o projeto
```

### Modelo de Dados
O projeto utiliza um modelo de dados baseado em RBAC, com as seguintes entidades principais:
- **User**: Representa os usuÃ¡rios do sistema.
- **Role**: PapÃ©is que definem permissÃµes.
- **Assignment**: Associa usuÃ¡rios a papÃ©is.
- **Transaction**: OperaÃ§Ãµes do sistema (ex.: criar, listar, excluir).
- **Authorization**: Associa papÃ©is a transaÃ§Ãµes, definindo permissÃµes.

---

## ğŸ“š DocumentaÃ§Ã£o TÃ©cnica

Para informaÃ§Ãµes tÃ©cnicas detalhadas sobre o projeto, consulte os documentos especÃ­ficos:

### ğŸ“Š **Modelo de Entidades e Relacionamentos**
- **Diagrama ER**: [DOCS/MODELS.png](DOCS/MODELS.png) - VisualizaÃ§Ã£o completa das entidades e seus relacionamentos no banco de dados.

### ğŸ” **Sistema de PermissÃµes (RBAC)**
- **Guia Completo**: [DOCS/PERMISSIONS.MD](DOCS/PERMISSIONS.MD) - DocumentaÃ§Ã£o detalhada sobre:
  - Como um usuÃ¡rio novo ganha permissÃµes
  - Como criar novas permissÃµes no sistema
  - Estrutura hierÃ¡rquica de roles
  - CenÃ¡rios prÃ¡ticos de uso
  - Sistema de seguranÃ§a e validaÃ§Ãµes

### ğŸ”„ **Fluxograma da AplicaÃ§Ã£o**
- **Fluxo TÃ©cnico**: [DOCS/FLUXOGRAMA.MD](DOCS/FLUXOGRAMA.MD) - Mapeamento completo dos fluxos da aplicaÃ§Ã£o:
  - Pontos de entrada (endpoints)
  - Pontos de decisÃ£o (middlewares e validaÃ§Ãµes)
  - Pontos de saÃ­da (respostas e persistÃªncia)
  - Agrupamentos naturais do sistema

### ğŸš€ **Deploy**
- **Guia Completo**: [DOCS/DEPLOYMENT.md](DOCS/DEPLOYMENT.md) - DocumentaÃ§Ã£o detalhada sobre:
  - ConfiguraÃ§Ã£o do ambiente de produÃ§Ã£o com Docker
  - Setup com PostgreSQL e Docker Compose
  - Comandos para gerenciamento de containers
  - Backup e restauraÃ§Ã£o do banco de dados
  - ConsideraÃ§Ãµes de seguranÃ§a e performance
  - Troubleshooting de problemas comuns

---

## âš™ï¸ Como Usar

Siga os passos abaixo para configurar e executar o projeto localmente.

### 1. Clonar o RepositÃ³rio
```bash
git clone https://github.com/jvras58/fastapi-crewai
cd fastapi-crewai
```

## 2.1 Montando o ambiente

Este repositÃ³rio esta organizando em um devcontainer.
E para instacia-lo no VSCODE Ã© recomendado as seguintes configuraÃ§Ãµes:

#### ExtenÃ§Ãµes recomendadas

- Name: Remote Development
- Id: ms-vscode-remote.vscode-remote-extensionpack
- Description: An extension pack that lets you open any folder in a container, on a remote machine, or in WSL and take advantage of VS Code's full feature set.
- Version: 0.25.0
- Publisher: Microsoft
- VSCode Marketplace Link: https://marketplace.visualstudio.com/items?itemName=ms-vscode-remote.vscode-remote-extensionpack

#### Docker Engine

Ã‰ obrigatÃ³rio ter o Docker Engine jÃ¡ instalado e cunfigurado. Para mais informaÃ§Ãµes de como instalar o Docker Engine em seu SO, ver em:

- InstruÃ§Ãµes para instalaÃ§Ã£o do Docker Engine: [Ver o link](https://docs.docker.com/engine/install/)

#### Procedimento para instanciar o projeto no VSCODE
1. Com o pack de extenÃ§Ãµes instalado,
1. Realize o clone/fork deste repositÃ³rio,
1. Abra o diretorio deste repositorio no VSCODE como um projeto,
1. Use o Comando _Dev Containers: Reopen in Container_ da paleta de comandos do VSCODE. _(F1, Ctrl+Shift+P)_.

Depois da compilaÃ§Ã£o do container o VSCode abrirÃ¡ o repositÃ³rio em um ambiente encapsulado e executando diretamente de dentro do container como configurado nas definiÃ§Ãµes do **/.devconainer**.

---

### 2.2 Configurar o Ambiente
Crie o arquivo `.env` baseado no modelo fornecido:
```bash
cp .env-semple .env
```

Edite o arquivo `.env` com as configuraÃ§Ãµes adequadas. Exemplo:
```plaintext
DB_URL="sqlite:///database.db"
SECURITY_ALGORITHM="HS256"
SECURITY_ACCESS_TOKEN_EXPIRE_MINUTES=30
```

Crie o diretÃ³rio `.secrets` e adicione o arquivo `SECURITY_API_SECRET_KEY` com um valor seguro:
```bash
mkdir .secrets
echo "SUA_CHAVE_SECRETA_AQUI" > .secrets/SECURITY_API_SECRET_KEY
```

### 3. Instalar DependÃªncias
Ative o ambiente virtual e instale as dependÃªncias com o UV:
```bash
uv sync
uv install
```
> Entre no ambiente virtual: source activate_env.sh

### 4. Aplicar MigraÃ§Ãµes
Execute as migraÃ§Ãµes para criar as tabelas no banco de dados:
A) aplique as migrations existentes:
```bash
alembic upgrade head
```
b) Suba os seedings de RBAC e de usuario admin
```bash
task setup_db
```

### 5. Executar a API
Inicie o servidor FastAPI com o comando:
```bash
task run
```

A API estarÃ¡ disponÃ­vel em:
- **URL Local**: [http://localhost:8000](http://localhost:8000)
- **DocumentaÃ§Ã£o Interativa**: [http://localhost:8000/api/v1/docs](http://localhost:8000/api/v1/docs) (Swagger UI)
- **DocumentaÃ§Ã£o Alternativa**: [http://localhost:8000/api/v1/redoc](http://localhost:8000/api/v1/redoc) (ReDoc)

### 6. Executar Testes
Para rodar os testes automatizados e verificar a cobertura:
```bash
task test
```

O relatÃ³rio de cobertura serÃ¡ gerado em `htmlcov/index.html`.

---

## ğŸ¤ Como Contribuir

ContribuiÃ§Ãµes sÃ£o sempre bem-vindas! Para contribuir com o projeto:

1. **Fork** o repositÃ³rio
2. Crie uma **branch** para sua feature (`git checkout -b feature/nova-feature`)
3. **Commit** suas mudanÃ§as (`git commit -m 'Adiciona nova feature'`)
4. **Push** para a branch (`git push origin feature/nova-feature`)
5. Abra um **Pull Request**

### PadrÃµes de ContribuiÃ§Ã£o
- Siga as convenÃ§Ãµes de cÃ³digo estabelecidas
- Escreva testes para novas funcionalidades
- Mantenha a documentaÃ§Ã£o atualizada
- Use mensagens de commit descritivas

---

## ğŸ“„ LicenÃ§a

Este projeto estÃ¡ licenciado sob a [MIT License](LICENSE). Veja o arquivo `LICENSE` para mais detalhes.

---

## ğŸ’¬ Contato

Se tiver dÃºvidas ou sugestÃµes, entre em contato:
- **Autores**: jvras <jvras58@gmail.com>
